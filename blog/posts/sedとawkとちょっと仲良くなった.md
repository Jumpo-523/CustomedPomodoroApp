
## なんの記事なのか？
仕事していく中で目についたsed, awkの使用例を１個１個理解しながら記録していくメモ記事です。


<a href="#case_one">**yamlファイルからenv変数作成shを作成する**</a>

## sedについて

### sedの仕様
まず、sedはファイルの中身を走査し、パターンに合う文字列を見つけたら、入れ替える処理を行ってくれるコマンドです。

- `;`で区切られた部分が1パターンになります。

- **`s/{{pattern}}/{{repl}}/g;`で`{{pattern}}`があったら`{{repl}}`に入れ替える処理を実行します。**

- `s/`と`/g`は始まりと終わりを示す仕様です。（言葉選ぶ）


<div id="case_one"></div>

####  利用ケース①：yaml fileをparseして環境変数に入れたい時、
- [参照link](https://stackoverflow.com/questions/5014632/how-can-i-parse-a-yaml-file-from-a-linux-shell-script)

今、

```yaml[file.yaml]
VAR1: XXXXXXXXXX
```
と言うyaml fileがあったときに、

```
VAR1="XXXXXXXXXX"
```
と言う風に変換したいとします。
この場合、sedを用いてfileの中身を変換することができます。

```sh
sed -e 's/:[^:\/\/]/="/g;s/$/"/g;s/ *=/=/g' file.yaml > file.sh
```

上記の処理を1から見ていきましょう。


- 上記の例の１個目のパターンは、
    - `{{pattern}}`が `:[^:\/\/]`
    - `="/g;`が`{{repl}}`に該当します。


ですので、`:`を見つけたら（注：`[^:\/\/]`は`://`に関しては無視するよーと言う正規表現の記法です。つまり、urlはそのままurlとして扱い、文字列入れ替えは行わないと言うことです。）`=”`に変えると言うことを意味してます。

次のパターンにいきましょう。

```
s/$/"/g
```

同じように読み解くと、
`$`、つまり行の終わりを見つけたら、`"`を付け加えよう！と言うことです。

最後のパターンですが、

```
s/ *=/=/g
```

これは、空白文字が`=`の前にあったらその空白を削除する、と言うことを意味しています。

苦手意識持っていたsedですが、一個一個見ていくと理解できますね。

sedの基本的な利用方法は確認したので、あとは、正規表現の理解を深めれば仲良く慣れそうですね。






## NEXT awkについて

[このサイト](https://shellscript.sunone.me/awk.html)が入門の入り口に良さそうでした！

```
AWK はフィルタリングによく使用されるコマンドであるが、同様にしてフィルタリングに使用される grep や cut と決定的に違うところは、AWK 自体が独立した一つのスクリプト言語であるということだ
```

ここがにわかエンジニアの人にとってとっつきづらいところになると思います。

```sh
sed -e 's/:[^:\/\/]/="/g;s/$/"/g;s/ *=/=/g' ./config/config.yml | awk '{print "export " $0 }' > set_env.sh
```

とはいってもやっていることは、上のsedコマンド処理で得た
```
VAR1="XXXXXXXXXX"
```
と言う文字列に、 "export "と言う文字を付け加えてあげて、 `set_env.sh`に新規で書き込んでいるだけですけども..

awkの細かい仕様はまたawkに出会った時にまとめます。**yamlファイルからenv変数作成shを作成するsed/awkの使い方**としてはこれで完成ですね！

### 組み込み変数
- NR: 現在読み込んでいる行の行番号
- $N: Nフィールド目の内容が設定されている














